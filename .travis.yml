language: objective-c
cache: bundler
before_script:
  - openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/profile/TravisExample_Ad_Hoc.mobileprovision.enc -d -a -out scripts/profile/TravisExample_Ad_Hoc.mobileprovision
  - openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.cer.enc -d -a -out scripts/certs/dist.cer
  - openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.p12.enc -d -a -out scripts/certs/dist.p12
  - ./scripts/add-key.sh
  - ./scripts/update-bundle.sh
script:
  - xctool -workspace TravisExample.xcworkspace -scheme TravisExample -sdk iphoneos -configuration Release OBJROOT=$PWD/build SYMROOT=$PWD/build ONLY_ACTIVE_ARCH=NO TESTFLIGHT_APP_TOKEN=$TESTFLIGHT_APP_TOKEN HOCKEY_APP_ID=$HOCKEY_APP_ID
  - xctool test -workspace TravisExample.xcworkspace -scheme TravisExampleTests -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
after_script:
  - ./scripts/remove-key.sh
after_success:
  - ./scripts/sign-and-upload.sh
env:
  global:
  - APP_NAME="TravisExample"
  - 'DEVELOPER_NAME="iPhone Distribution: Mattes Groeger"'
  - PROFILE_NAME="TravisExample_Ad_Hoc"
  - INFO_PLIST="TravisExample/TravisExample-Info.plist"
  - BUNDLE_DISPLAY_NAME="Travis Example CI"
  - secure: UKgpyNUjC6YldsRid6domxiVTYEttz0fm53DV8om8EKd2C6WffuhwQrhsr5I9r1Vb3nxZbyYcr7mlfAwf34/fVooXFagJhC2dXq2lqw0WbShOAKI5FrXUn7O8plApcqKVIKNJKv44IXYxcUKbIDzNKN02vZqpFleeQfvCjqtQgs=
  - secure: vMoGvsa5rUi/nyt4ghRmEdygIWYj8Mt4+XWQ7n9P/rW7c4VWrVsmAwACxvijWr/cTzv6c7ORanAOx1+babM8TYNrDq7bWoENZiRBkjIOMEmb6Z5HVLidVLcgW27xklmuvN9kAnYRu3efVz3cIdJrKbLDKjAj7l/u12617LukZZk=
  - secure: gf2h0nkTX+9pta7YfVLdHdjSDpHMrWMntZRboJBnifN1Is5rQvG+ke4NJnqlQcZHIJrmGAAbVaWBpveVDXyK9uqV8KT8zppWvdMj6xSleLTjczWZGk6cP4rBkgaR9C6B6gR/qjV0k3AIRCWzWZkddK1gbFbR0H6itw3xvrj3lGE=
  - secure: rVJcjWp3MYtP3sxL6ep3HHwmN9yyqWBYb1KxrTBpK3HyA/X+FpgDvd/+KhwzIrpVi2twzDY/EDC86wJC2d8s9Gx2gOeX+ooXkYcHAYDRvQktTSuzFcJw+5xBV3c+jPzaXn3XoeJAwRuJOojrLwMYRlxE1A4xI7wsCiVLfB7YgtE=
  - secure: DWhC8DNtNnZib1REvCZvmZxWj97tmVJt4c+GrB67snGXtvZvqHCfqnENYiCAaAz2TE8botbO4a6cxAxtwhuck8s4s9yWR+F2fnPwKD/740Qml6BD58saIeQrVQZ78hLNU1nE7p/lHuC9flAhKdfom0i7gNbaHEO1lYP0/1+ZOT0=
  - secure: FBIgRjMrq1ewobYx6GkMJcqkWf49DwqYialD+Sby870uuKz2Yt9OmmwnGEmZNXkm+sCTh7qROjeGVSLbwxhnmuBdsdXI4Gzw8VBaVmPVmyFvn9Kzz/5YPIQ6rbzuMrUzEoY8o+RZ+aujqaPFp6ahvlAplVxn2+qCnXtBdNZlfjA=
  - secure: g8vf3vYovX5mTZwzT7o91kokRKoXQAaqdxBV1n0QD2RHjZ9uotyR83HR3J1ADSztKHb/Kh0i/P7pIhZdpA2mdtHbbZ/weMuUBDLvAPd+LvAYXYpd7O1xh7Obmw5K3YEfXGijL4ZI5LpcYwaW6ng6tDUVdCi8i29ZgSgI32mNZ0g=
